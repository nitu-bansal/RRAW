/// <reference path="http://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js" />
/// <reference path="GetAsync.min.js" />
/// <reference path="Resizer.js" />

var loginPageURL = 'Login.aspx?ResponsePage=Issues.aspx';

$(document).ready(function () {
    if (getCookie("AuthenticationToken") == undefined) {
        window.location = loginPageURL;
    }

    LoadContents();
});

function SetHeight() {
    document.getElementById('primaryContent').style.height = (123 + document.getElementById('pageParking').offsetHeight) + 'px';
    document.getElementById('content').style.height = document.getElementById('primaryContent').offsetHeight + 'px';
    document.getElementById('navigation').style.height = (document.getElementById('content').offsetHeight - 100) + 'px';
    document.getElementById('primaryContent').style.height = (document.getElementById('content').offsetHeight - 100) + 'px';
}

//function OnSuccessOfGetNewTicketPage(res) {
//    document.getElementById('pageParking').innerHTML = res;

//    handleResize('SetHeight');

//    document.getElementById('loading_notifier').style.display = 'none';

//    SetHeight();

//    GetAllModules();

//    $("#selModules").focus();
//}

//function errGetNewTicketPage(err) {
//    window.location = 'Issues.aspx';
//}

function LoadContents() {
    //GetAsync('NewTicket.htm', 'OnSuccessOfGetNewTicketPage', 'errGetNewTicketPage');
    
    document.getElementById('interior').style.background = 'url(/Images/Blogs/bg-home-tile.jpg) repeat-x scroll 50% 0 #39414A';
    document.getElementById('interior').style.backgroundImage = 'url(/Images/Blogs/bg-interior-tile-drk.jpg)';
    document.getElementById('content').style.background = 'url(/Images/Blogs/bg_home_content.gif) repeat-x scroll center top #181C21';
    document.getElementById('ownerLogo').href = 'http://searce.com/';

    handleResize('SetHeight');

    //SetHeight();

    GetAllModules();

    $("#selModules").focus();
}

// NewTicket.aspx

function GetAllModules() {
    RRAW.WebServices.Issues.GetAllModules(getCookie("AuthenticationToken"), onSuccessOfGetAllModules);
}

function onSuccessOfGetAllModules(res) {
    if ($(res)[0].RedirectionPath != undefined) {
        window.location = loginPageURL;
    }

    $("#selModules").children().remove();

    $.each(res, function (key, val) {
        $('#selModules').append($("<option></option>").attr("value", key).text(val));
    });
}

function getCookie(c_name) {
    var i, x, y, ARRcookies = document.cookie.split(";");
    for (i = 0; i < ARRcookies.length; i++) {
        x = ARRcookies[i].substr(0, ARRcookies[i].indexOf("="));
        y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1);
        x = x.replace(/^\s+|\s+$/g, "");
        if (x == c_name) {
            return unescape(y);
        }
    }
}