/// <reference path="GetAsync.min.js" />

function SetHeight() {
    document.getElementById('primaryContent').style.height = (123 + document.getElementById('blogParking').offsetHeight) + 'px';
    document.getElementById('content').style.height = document.getElementById('primaryContent').offsetHeight + 'px';
    document.getElementById('navigation').style.height = (document.getElementById('content').offsetHeight - 100) + 'px';
    document.getElementById('primaryContent').style.height = (document.getElementById('content').offsetHeight - 100) + 'px';
}

function GetContents(res) {
    document.getElementById('blogParking').innerHTML = res;

    document.getElementById('loading_notifier').style.display = 'none';

    SetHeight();
}

function GetBlogEntries(res) {
    document.getElementById('lblBlogTitle').innerHTML = res.slice(res.indexOf('<span id="lblTitle">') + ('<span id="lblTitle">').length, res.indexOf('{EndTitle}'));

    if (document.getElementById('lblBlogTitle').innerHTML == "LoginRequired") {
        window.location = 'Login.aspx?ResponsePage=Blog.aspx';
    }
    else {
        document.getElementById('blogEntries').innerHTML = res.slice(res.indexOf('<div id="divBlogEntries">') + ('<div id="divBlogEntries">').length, res.indexOf('<div id="divBlogEntriesComplete">'));
        //document.getElementById('lblBlogTitle2').innerHTML = res.slice(res.indexOf('<span id="lblTitle">') + ('<span id="lblTitle">').length, res.indexOf('{EndTitle}'));
        var PostedOn = res.slice(res.indexOf('<span id="lblPostedOn">') + ('<span id="lblPostedOn">').length, res.indexOf('{EndPostedOn}'));
        var PostedBy = res.slice(res.indexOf('<span id="lblPostedBy">') + ('<span id="lblPostedBy">').length, res.indexOf('{EndPostedBy}'));
        document.getElementById('lblBlogPostedInfo').innerHTML = 'Posted on ' + PostedOn + ' by ' + PostedBy;

        document.getElementById('navigation').style.minHeight = document.getElementById('primaryContent').offsetHeight + 'px';
        document.getElementById('primaryContent').style.minHeight = document.getElementById('primaryContent').offsetHeight + 'px';

        GetAsync(res.slice(res.indexOf('<span id="lblFilePath">') + ('<span id="lblFilePath">').length, res.indexOf('{EndFilePath}')), 'GetContents');
    }
}

function errGetBlogEntries(err) {
    window.location = 'Blog.aspx';
}

function LoadBlog(title, filePath, PostedOn, PostedBy) {
    if (document.getElementById('lblBlogTitle').innerHTML != title) {
        document.getElementById('blogParking').innerHTML = '<br /><br /><br /><br /><br /><br />';
        document.getElementById('loading_notifier').style.display = 'block';

        GetAsync(filePath, 'GetContents', 'GetContents');

        document.getElementById('lblBlogTitle').innerHTML = title;

        document.getElementById('lblBlogPostedInfo').innerHTML = 'Posted on ' + PostedOn + ' by ' + PostedBy
    }
}

function LoadContents() {
    GetAsync('GetBlogEntries.aspx?Title=' + QueryString('Title'), 'GetBlogEntries', 'errGetBlogEntries');

    document.getElementById('interior').style.background = 'url(/Images/Blogs/bg-home-tile.jpg) repeat-x scroll 50% 0 #39414A';
    document.getElementById('interior').style.backgroundImage = 'url(/Images/Blogs/bg-interior-tile-drk.jpg)';
    document.getElementById('content').style.background = 'url(/Images/Blogs/bg_home_content.gif) repeat-x scroll center top #181C21';
}

function QueryString(key) {
    var re = new RegExp('(?:\\?|&)' + key + '=(.*?)(?=&|$)', 'gi');
    var r = [], m;
    while ((m = re.exec(document.location.search)) != null) r[r.length] = m[1];
    return r;
}