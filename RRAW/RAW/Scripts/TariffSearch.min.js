



$(document).ready(function () {
    $("#cmbSelect").select2({
        placeholder: "Search for a Tariff/ rate request",
        minimumInputLength: 2,
        multiple: true,
        width: "1200",
        ajax: {
            url: "/WebServices/Select2.asmx/GetTempjson",
            type: "GET",
            dataType: 'json',
            quietMillis: 100,
            data: function (term, page) { // page is the one-based page number tracked by Select2
                return {
                    Data: term //search term
                    //                page_limit: 10, // page size
                    //                page: page, // page number
                    //                apikey: "ju6z9mjyajq2djue3gbvv26t" // please do not use so this example keeps working
                };
            },
            results: function (data, page) {
                //var more = 10; // whether or not there are more results available

                //            // notice we return the value of more so Select2 knows if more results can be loaded
                //return { results: data, more: more };
                return { results: data };
            }
        },
        formatResult: movieFormatResult, // omitted for brevity, see the source of this page
        formatSelection: movieFormatSelection, // omitted for brevity, see the source of this page
        initSelection: function (element, callback) {
            // the input tag has a value attribute preloaded that points to a preselected movie's id
            // this function resolves that id attribute to an object that select2 can render
            // using its formatResult renderer - that way the movie name is shown preselected
            var id = $(element).val();
        },
        dropdownCssClass: "bigdrop", // apply css that makes the dropdown taller
        escapeMarkup: function (m) { return m; } // we do not want to escape markup since we are displaying html in results
    });

    $("#cmbSelect").change(function () {
        //        alert($("#cmbSelect").select2("val"));
    });


    $("#btnSearch").click(function () {       

        if ($("#cmbSelect").select2("val") == "") {
            alert("please select atlease one criteria");
        } else {
            GetGlobalTariffs();
        }
    });


});

function movieFormatResult(data) {
    return "<table><tr><td>" + data.DisplayValue + ":" + "</td><td>" + data.ColumnValue + "</td></tr></table>";

}

function movieFormatSelection(data) {
    return "<table><tr><td>" + data.DisplayValue + ":" + "</td><td>" + data.ColumnValue + "</td></tr></table>";
}

var initSelection = function initSelection(elem, cb) {
    console.log(elem)
    return elem;
}

//------------------------------------------------------------------------------------------------------------------------------------------------------------------------
function GetGlobalTariffs() {
    RRAW.AirRateRequests.GetTariffGlobally(AuthenticationToken(), $("#cmbSelect").select2("val").toString(), onSuccessOfGetTariffGlobally, onFailureOfGetTariffGlobally);
}

function onFailureOfGetTariffGlobally(res) {
    window.location = "Errors.aspx?Operation=GetTariffGlobally&ExceptionType=" + res._exceptionType + "&Msg=" + res._message + "&StackTrace=" + res._stackTrace + "&TimedOut=" + res._timedOut;
}

function onSuccessOfGetTariffGlobally(res) {
    var strHTML = res;
    $("#divTariff").html("");


    if (strHTML == "" || strHTML == "Error") {
        $("#divTariff").html("No Tariff/Rate Request Available");
    }
    else {
        $("#divTariff").append(strHTML);

    }

    $("#divTariff").fadeIn();

}


function AuthenticationToken() {
    return GetCookie("AuthenticationToken");
}

function GetCookie(c_name) {
    var i, x, y, ARRcookies = document.cookie.split(";");
    for (i = 0; i < ARRcookies.length; i++) {
        x = ARRcookies[i].substr(0, ARRcookies[i].indexOf("="));
        y = ARRcookies[i].substr(ARRcookies[i].indexOf("=") + 1);
        x = x.replace(/^\s+|\s+$/g, "");
        if (x == c_name) {
            return unescape(y);
        }
    }
}

//------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------